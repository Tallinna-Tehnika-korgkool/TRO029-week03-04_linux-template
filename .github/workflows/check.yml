name: Check Assignment

on:
  push:
    branches:
      - "**"   # kÃ¤ivita igal branchil

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate assignment
        run: |
          echo "ğŸš€ Alustan kontrolli..."
          ERRORS=0

          # Kontrolli failid
          echo "ğŸ“‚ Kontrollin faile..."
          for f in "harjutus/kasutatud_kÃ¤sud.txt" "harjutus/minu_fail.txt"; do
            if [ -f "$f" ]; then
              echo "âœ… Fail olemas: $f"
            else
              echo "âŒ Puudub fail: $f"
              ERRORS=$((ERRORS+1))
            fi
          done

          # Kontrolli vajalikud kÃ¤sud
          echo "ğŸ” Kontrollin kasutatud kÃ¤ske..."
          REQUIRED=("mkdir" "nano" "chmod" "ls" "sleep" "kill")
          if [ -f "harjutus/kasutatud_kÃ¤sud.txt" ]; then
            for cmd in "${REQUIRED[@]}"; do
              if grep -q "$cmd" harjutus/kasutatud_kÃ¤sud.txt; then
                echo "âœ… KÃ¤sk leitud: $cmd"
              else
                echo "âŒ KÃ¤sk puudub: $cmd"
                ERRORS=$((ERRORS+1))
              fi
            done
          else
            echo "âš ï¸ KÃ¤ske ei saa kontrollida, sest harjutus/kasutatud_kÃ¤sud.txt puudub"
            ERRORS=$((ERRORS+1))
          fi

          # Kontrolli faili Ãµigused
          echo "ğŸ”‘ Kontrollin faili Ãµiguseid..."
          if [ -f "harjutus/minu_fail.txt" ]; then
            PERMS=$(stat -c "%A" harjutus/minu_fail.txt)
            echo "Faili Ãµigused: $PERMS"
            if echo "$PERMS" | grep -q "rw"; then
              echo "âœ… Failil on omaniku RW Ãµigused"
            else
              echo "âŒ Failil ei ole omaniku RW Ãµiguseid"
              ERRORS=$((ERRORS+1))
            fi
          fi

          # KokkuvÃµte
          echo "--------------------------------"
          if [ $ERRORS -eq 0 ]; then
            echo "ğŸ‰ KÃµik korras! Harjutus lÃ¤bitud."
            exit 0
          else
            echo "âŒ Kokku leitud vigu: $ERRORS"
            exit 1
          fi
